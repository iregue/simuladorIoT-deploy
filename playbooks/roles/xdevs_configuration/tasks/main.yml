---
# tasks file for xdevs_configuration
- name: Copy java.main from template
  become: true
  copy:
    src: "{{ gpt_template_path }}"
    dest: "{{ gpt_path }}"
    owner: iregueiro
    group: iregueiro
    mode: '0664'

- name: configure ficheros
  lineinfile:
    path: "{{ gpt_path }}"
    insertafter: '^# ANSIBLE FICHEROS$'
    backup: no
    state: present
    line: |
            Ficheros {{ item }} = new Ficheros("{{ item }}", period, userDirectory + "/data/pruebas/");
            super.addComponent({{ item }});
  loop: "{{ ficheros|reverse|list }}"

- name: configure nodos virtuales
  lineinfile:
    path: "{{ gpt_path }}"
    insertafter: '^# ANSIBLE NVIRTUAL$'
    backup: no
    state: present
    line: |
            NodoVirtual {{ item }} = new NodoVirtual("{{ item }}", period);
            super.addComponent({{ item }});
  loop: "{{ nodo_virtual|reverse|list }}"

- name: configure fog servers
  lineinfile:
    path: "{{ gpt_path }}"
    insertafter: '^# ANSIBLE FOGSERVER$'
    backup: no
    state: present
    line: |
            FogServer {{ item }} = new FogServer("{{ item }}", period);
            super.addComponent({{ item }});
  loop: "{{ fog_server|reverse|list }}"

- name: configure data center
  lineinfile:
    path: "{{ gpt_path }}"
    insertafter: '^# ANSIBLE DATACENTER$'
    backup: no
    state: present
    line: |
            DataCenter {{ item }} = new DataCenter("{{ item }}", period);
            super.addComponent({{ item }});
  loop: "{{ data_center|reverse|list }}"

- name: configure conectores fogServer
  lineinfile:
    path: "{{ gpt_path }}"
    insertafter: '^# ANSIBLE CONECTOR$'
    backup: no
    state: present
    line: super.addCoupling({{ item.out }}.oOut, {{ item.in }}.iInDataCenter);
  loop: "{{ conectores|reverse|list }}"
  when: item.out_type == "fogServer"

- name: configure conectores NodoVirtual
  lineinfile:
    path: "{{ gpt_path }}"
    insertafter: '^# ANSIBLE CONECTOR$'
    backup: no
    state: present
    line: super.addCoupling({{ item.out }}.oOut, {{ item.in }}.iIn{{item.out|title }});
  loop: "{{ conectores|reverse|list }}"
  when: item.out_type == "nodoVirtual"

- name: configure conectores ficheros
  lineinfile:
    path: "{{ gpt_path }}"
    insertafter: '^# ANSIBLE CONECTOR$'
    backup: no
    state: present
    line: super.addCoupling({{ item.out }}.oOut, {{ item.in }}.iInFichero);
  loop: "{{ conectores|reverse|list }}"
  when: item.out_type == "ficheros"
